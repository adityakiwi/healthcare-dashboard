{"ast":null,"code":"var _jsxFileName = \"/Users/aditya/Dropbox/Senior S1/ST/dashboard/src/views/dashboard/DashboardView/StackedBarChart.js\";\nimport React from 'react';\nimport * as d3 from 'd3';\nimport * as d3l from 'd3-svg-legend';\nimport './StackedBarChart.css';\n\nclass StackedBarChart extends React.Component {\n  constructor(props) {\n    super(props);\n    this.removeExistingBars = this.removeExistingBars.bind(this);\n    this.createBarChart = this.createBarChart.bind(this);\n    this.state = {\n      svg: null,\n      div: null\n    };\n  }\n\n  componentDidMount() {\n    const owidth = this.props.size[0];\n    const oheight = this.props.size[1];\n    var margin = {\n      top: 20,\n      right: 0,\n      bottom: 20,\n      left: 70\n    },\n        width = owidth - margin.left - margin.right,\n        height = oheight - margin.top - margin.bottom;\n    const svg = d3.select(\"body\").select(\"#lc\").append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n    const div = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip-donut\").style(\"opacity\", 0);\n    this.setState({\n      svg,\n      div,\n      width,\n      height\n    });\n  }\n\n  componentDidUpdate() {\n    this.removeExistingBars();\n    this.createBarChart();\n  }\n\n  midpoint(range) {\n    return range[0] + (range[1] - range[0]) / 2.0;\n  }\n\n  removeExistingBars() {\n    const {\n      svg\n    } = this.state;\n    svg.selectAll(\"*\").remove();\n  }\n\n  createBarChart() {\n    const {\n      svg\n    } = this.state;\n    const {\n      div\n    } = this.state;\n    const owidth = this.props.size[0];\n    const oheight = this.props.size[1];\n    var margin = {\n      top: 20,\n      right: 0,\n      bottom: 20,\n      left: 70\n    },\n        width = owidth - margin.left - margin.right,\n        height = oheight - margin.top - margin.bottom;\n    let data = this.props.data;\n    let female = data.filter(function (e) {\n      return e.gender === \"F\";\n    });\n    let male = data.filter(function (e) {\n      return e.gender === \"M\";\n    });\n    data = male;\n    var yScale = d3.scaleBand().range([margin.top, height - margin.bottom]).padding(0.1).paddingOuter(0.2).rangeRound([0, height]).align(0.1);\n    var xScale = d3.scaleLinear().rangeRound([0, width]);\n    var zScale = d3.scaleOrdinal(d3.schemeCategory10);\n    console.log(\"newdata filter\", data);\n    let output = [];\n    data.forEach(function (item) {\n      console.log(\"each item\", item);\n      var exist = output.filter(function (v, i) {\n        return v.disease == item.disease;\n      });\n      console.log(\"exist\", exist);\n\n      if (exist.length) {\n        var index = output.indexOf(exist[0]);\n        var total = output[index].total + item.total;\n        console.log(\"index\", index);\n        console.log(\"total\", total);\n        Object.assign(output[index], item);\n        output[index].total = total;\n      } else {\n        if (typeof item.value == 'string') {\n          console.log(\"string\", item.value);\n          item.value = [item.value];\n        }\n\n        console.log(\"item\", item);\n        output.push(item);\n      }\n    });\n    output.sort(function (a, b) {\n      return b.total - a.total;\n    });\n    var keys = [\"Government\", \"Medicaid\", \"Medicare\", \"Private\", \"Self Pay\"];\n    xScale.domain([0, 1500]);\n    yScale.domain(output.map(function (d) {\n      return d.disease;\n    }));\n    zScale.domain(keys);\n    console.log(\"keys\");\n    console.log(keys);\n    console.log(\"output\");\n    console.log(output);\n    console.log(\"d3\");\n    console.log(d3.stack().keys(keys)(output));\n    svg.attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n    svg.append(\"g\").attr(\"class\", \"axis\").style(\"stroke\", \"lightslategray\").call(d3.axisLeft(yScale).ticks(null, \"s\"));\n    svg.append(\"g\").attr(\"class\", \"axis\").attr(\"transform\", \"translate(0,\" + height + \")\").style(\"stroke\", \"lightslategray\").call(d3.axisBottom(xScale).ticks(16, \"f\"));\n    svg.append(\"g\").selectAll(\"g\").data(d3.stack().keys(keys)(output)).enter().append(\"g\").attr(\"fill\", function (d) {\n      return zScale(d.key);\n    }).selectAll(\"rect\").data(function (d) {\n      {\n        console.log(\"stacked\", d);\n      }\n      return d;\n    }).enter().append(\"rect\").attr(\"y\", function (d) {\n      {\n        console.log(\"y\", d);\n      }\n      return yScale(d.data.disease);\n    }).attr(\"x\", function (d) {\n      {\n        console.log(\"x\", d);\n      }\n      return xScale(d[0]);\n    }).attr(\"height\", function (d) {\n      return yScale.bandwidth().on(\"mouseover\", function (event, d) {\n        d3.select(this).transition().duration('50').attr('opacity', .50);\n        console.log(d, event); /// add to html\n\n        div.transition().duration(50).style(\"opacity\", 1);\n        let key = Object.keys(d.data).find(key => d.data[key] === d[1] - d[0]);\n        div.html(\" Alarm Type: \" + key + \"<br>\" + \"Total Number of Alarms: \" + (d[1] - d[0])).style(\"left\", event.pageX - 30 + \"px\").style(\"top\", event.pageY - 15 + \"px\");\n      }).on(\"mouseout\", function (d) {\n        d3.select(this).transition().duration('50').attr('opacity', 1);\n        div.transition().duration('50').style(\"opacity\", 0);\n      }).transition().duration(2000) //time in ms\n      .attr(\"width\", function (d) {\n        {\n          console.log(\"d0\", d[0]);\n        }\n        {\n          console.log(\"d1\", d[1]);\n        }\n        return xScale(d[1]) - xScale(d[0]);\n      });\n    });\n  }\n\n  render() {\n    return /*#__PURE__*/React.createElement(\"svg\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 13\n      }\n    });\n  }\n\n}\n\nexport default StackedBarChart;","map":{"version":3,"sources":["/Users/aditya/Dropbox/Senior S1/ST/dashboard/src/views/dashboard/DashboardView/StackedBarChart.js"],"names":["React","d3","d3l","StackedBarChart","Component","constructor","props","removeExistingBars","bind","createBarChart","state","svg","div","componentDidMount","owidth","size","oheight","margin","top","right","bottom","left","width","height","select","append","attr","style","setState","componentDidUpdate","midpoint","range","selectAll","remove","data","female","filter","e","gender","male","yScale","scaleBand","padding","paddingOuter","rangeRound","align","xScale","scaleLinear","zScale","scaleOrdinal","schemeCategory10","console","log","output","forEach","item","exist","v","i","disease","length","index","indexOf","total","Object","assign","value","push","sort","a","b","keys","domain","map","d","stack","call","axisLeft","ticks","axisBottom","enter","key","bandwidth","on","event","transition","duration","find","html","pageX","pageY","render"],"mappings":"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","sourcesContent":["import React from 'react';\nimport * as d3 from 'd3';\nimport * as d3l from 'd3-svg-legend'\nimport './StackedBarChart.css'\n\nclass StackedBarChart extends React.Component {\n    constructor(props) {\n        super(props)\n        this.removeExistingBars = this.removeExistingBars.bind(this);\n        this.createBarChart = this.createBarChart.bind(this)\n        this.state = {\n            svg: null,\n            div: null\n        };\n\n    }\n    componentDidMount() {\n        const owidth = this.props.size[0]\n        const oheight = this.props.size[1]\n\n        var margin = { top: 20, right: 0, bottom: 20, left: 70 },\n            width = owidth - margin.left - margin.right,\n            height = oheight - margin.top - margin.bottom;\n\n        const svg = d3.select(\"body\").select(\"#lc\").append(\"svg\")\n            .attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\n        const div = d3.select(\"body\").append(\"div\")\n            .attr(\"class\", \"tooltip-donut\")\n            .style(\"opacity\", 0);\n\n        this.setState({ svg, div, width,height });\n    }\n    componentDidUpdate() {\n        this.removeExistingBars();\n        this.createBarChart();\n    }\n\n    midpoint(range) {\n        return range[0] + (range[1] - range[0]) / 2.0;\n    }\n\n    removeExistingBars() {\n        const { svg } = this.state;\n\n        svg.selectAll(\"*\").remove();\n\n    }\n\n    createBarChart() {\n        const { svg } = this.state;\n        const { div } = this.state;\n\n        const owidth = this.props.size[0]\n        const oheight = this.props.size[1]\n\n        var margin = { top: 20, right: 0, bottom: 20, left: 70 },\n            width = owidth - margin.left - margin.right,\n            height = oheight - margin.top - margin.bottom;\n\n        let data = this.props.data\n        let female = data.filter(function (e) {\n            return e.gender === \"F\";\n        });\n\n\n        let male = data.filter(function (e) {\n            return e.gender === \"M\";\n        });\n\n        data = male\n\n        var yScale = d3.scaleBand()\n            .range([margin.top, height - margin.bottom])\n            .padding(0.1)\n            .paddingOuter(0.2)\n            .rangeRound([0, height])\n            .align(0.1);\n\n        var xScale = d3.scaleLinear()\n            .rangeRound([0, width]);\n\n        var zScale = d3.scaleOrdinal(d3.schemeCategory10)\n\n        console.log(\"newdata filter\", data)\n\n        let output = []\n\n        data.forEach(function (item) {\n            console.log(\"each item\", item)\n            var exist = output.filter(function (v, i) {\n                 return v.disease == item.disease\n            });\n            console.log(\"exist\", exist)\n            if (exist.length) {\n                var index = output.indexOf(exist[0]);\n                var total = output[index].total + item.total;\n                console.log(\"index\", index)\n                console.log(\"total\", total)\n                Object.assign(output[index], item);\n                output[index].total = total;\n            } else {\n                if (typeof item.value == 'string') {\n                    console.log(\"string\", item.value)\n                    item.value = [item.value];\n                }\n                console.log(\"item\", item)\n                output.push(item);\n            }\n        });\n        output.sort(function (a, b) { return b.total - a.total; });\n        var keys = [\"Government\", \"Medicaid\", \"Medicare\", \"Private\", \"Self Pay\"]\n        xScale.domain([0, 1500])\n\n\n        yScale.domain(output.map(function (d) { return d.disease; }));\n\n        zScale.domain(keys)\n\n        console.log(\"keys\")\n        console.log(keys)\n\n\n        console.log(\"output\")\n        console.log(output)\n\n        console.log(\"d3\")\n        console.log(d3.stack().keys(keys)(output))\n\n        svg.attr(\"width\", width + margin.left + margin.right)\n            .attr(\"height\", height + margin.top + margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n        svg.append(\"g\")\n            .attr(\"class\", \"axis\")\n            .style(\"stroke\", \"lightslategray\")\n            .call(d3.axisLeft(yScale).ticks(null, \"s\"));\n        svg.append(\"g\")\n            .attr(\"class\", \"axis\")\n            .attr(\"transform\", \"translate(0,\" + height + \")\")\n            .style(\"stroke\", \"lightslategray\")\n            .call(d3.axisBottom(xScale).ticks(16, \"f\"));\n            \n        svg.append(\"g\")\n            .selectAll(\"g\")           \n            .data(d3.stack().keys(keys)(output))\n            .enter().append(\"g\")\n            .attr(\"fill\", function (d) { return zScale(d.key) })\n            .selectAll(\"rect\").data(function (d) { {console.log(\"stacked\",d) } return d; })\n            .enter().append(\"rect\")\n            .attr(\"y\", function (d) { { console.log(\"y\", d) }  return yScale(d.data.disease) })\n            .attr(\"x\", function (d) { { console.log(\"x\", d) } return xScale(d[0]) })\n            .attr(\"height\", function (d) {\n                return yScale.bandwidth()\n            .on(\"mouseover\", function (event, d) {\n                d3.select(this).transition()\n                    .duration('50')\n                    .attr('opacity', .50);\n                console.log(d, event)\n                /// add to html\n                div.transition()\n                    .duration(50)\n                    .style(\"opacity\", 1)\n                let key = Object.keys(d.data).find(key => d.data[key] === d[1] - d[0]);\n\n                div.html(\" Alarm Type: \" + key + \"<br>\" + \"Total Number of Alarms: \" + (d[1] - d[0]))\n                    .style(\"left\", (event.pageX - 30) + \"px\")\n                    .style(\"top\", (event.pageY - 15) + \"px\")\n\n            })\n            .on(\"mouseout\", function (d) {\n                d3.select(this).transition()\n                .duration('50')\n                .attr('opacity', 1)\n                div.transition()\n                    .duration('50')\n                    .style(\"opacity\", 0)\n            })\n            .transition()\n            .duration(2000)//time in ms\n            .attr(\"width\", function (d) {\n                { console.log(\"d0\", d[0]) } { console.log(\"d1\", d[1]) }\n                return xScale(d[1]) - xScale(d[0])\n            })\n})\n\n\n    }\n\n    render() {\n        return (\n            <svg />\n        )\n    }\n}\nexport default StackedBarChart;\n\n"]},"metadata":{},"sourceType":"module"}